<dom-module id="cont-drawer-peticiones">
    <link rel="import" href="cont-drawer-peticiones-styles.html">
    <link rel="import" href="../cont-peticion/cont-peticion.html">
    <template>
        <!-- estilo -->
        <style type="text/css" is="custom-style" include="cont-drawer-peticiones-styles"></style>
        <style>
        :host {
            display: block;
        }
        </style>
        <div class="contenido">
            <paper-icon-button icon="cached" on-tap='actualizaPeticiones'></paper-icon-button>
            <div id='contenedorPeticiones'>
                <!-- Mensaje temporal -->
                <template is='dom-if' if='{{!peticiones.length}}'>
                    <paper-material>
                        <paper-item class="aviso">Aquí aparecerán las nuevas peticiones</paper-item>
                    </paper-material>
                </template>
                <!-- Iterador sobre las peticiones -->
                <div class="layout horizontal">
                    <template id='peticiones' is='dom-repeat' items='{{peticiones}}'>
                        <div class="flex">
                            <cont-peticion cliente="{{item.cliente}}" telefono="{{item.telefono}}" fecha="{{item.fecha}}" imagenMapa="{{item.imagenMapa}}" calleOrigen="{{item.calleOrigen}}" numeroOrigen="{{item.numeroOrigen}}" coloniaOrigen="{{item.coloniaOrigen}}" delegacionOrigen="{{item.delegacionOrigen}}" calleDestino="{{item.calleDestino}}" numeroDestino="{{item.numeroDestino}}" coloniaDestino="{{item.coloniaDestino}}" delegacionDestino="{{item.delegacionDestino}}"></cont-peticion>
                        </div>
                    </template>
                </div>
            </div>
        </div>
        <iron-ajax id="ajax" method="POST" url="../../peticiones.php" handle-as="json" on-response="despliegaPeticiones" </iron-ajax>
    </template>
    <script>
    Polymer({
        is: "cont-drawer-peticiones",
        ready: function() {
            console.log("cont-drawer-peticiones ready!");
        },
        properties: {
            peticiones: {
                type: Array,
                value: []
            }
        },
        actualizaPeticiones: function(e) {
            console.log("act");
            var datalist = 'nuevas=1';
            console.log(datalist);
            this.$.ajax.body = datalist;
            this.$.ajax.generateRequest();
        },
        despliegaPeticiones: function(r) {
            this.peticiones = [];
            console.log(r.detail.response.peticiones);
            var pets = r.detail.response.peticiones;
            for (var i = pets.length - 1; i >= 0; i--) {
              this.peticiones.push(pets[i]);
            };
            console.log(this.peticiones);
            for (var i = this.peticiones.length - 1; i >= 0; i--) {
              console.log(this.peticiones[i].cliente);
            };
        }
    });
    </script>
</dom-module>
